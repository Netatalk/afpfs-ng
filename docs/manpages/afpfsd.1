.Dd December 25, 2025
.Dt AFPFSD 1
.Os afpfs-ng
.Sh NAME
.Nm afpfsd
.Nd Daemon to manage AFP sessions for the afpfs-ng FUSE client
.Sh SYNOPSIS
.Nm
.Op Fl l | Fl -logmethod Ar method
.Op Fl v | Fl -loglevel Ar level
.Op Fl f | Fl -foreground
.Op Fl d | Fl -debug
.Op Fl m | Fl -manager
.Op Fl s | Fl -socket-id Ar socket_name
.Sh DESCRIPTION
.Nm
is the daemon used by the FUSE client.
It is typically not run directly by users; rather,
it is started automatically by
.Xr afp_client 1
or
.Xr mount_afpfs 1
if not already running.
.Pp
There are two modes:
.Bl -bullet
.It
.Em Manager daemon
(one per user): started with
.Fl -manager ,
listens on a shared socket, and spawns mount-specific daemons.
.It
.Em Mount daemon
(one per mount): started with
.Fl -socket-id ,
owns a single FUSE mount.
.El
.Pp
.Xr afp_client 1
talks to the manager; the manager spawns per-mount
daemons as needed.
Management commands (status, unmount, exit) go to the
manager, which coordinates the mount daemons.
.Sh OPTIONS
.Bl -tag -width Ds
.It Fl l , Fl -logmethod Ar method
Sets the method used to log.
Values are
.Cm stdout
or
.Cm syslog .
.It Fl v , Fl -loglevel Ar level
Sets the log verbosity level.
Values are
.Cm debug ,
.Cm info ,
.Cm notice ,
.Cm warning ,
and
.Cm error .
.It Fl f , Fl -foreground
Doesn't fork the daemon.
.It Fl d , Fl -debug
Puts the daemon in the foreground, sets log level to debug, and dumps logs to stdout.
.It Fl m , Fl -manager
Run in manager mode (per user).
This is started automatically by
.Xr afp_client 1
if not already running.
.It Fl s , Fl -socket-id Ar socket_name
Specifies the Unix domain socket filename to listen on.
The manager listens on
.Pa /tmp/afp_server- Ns Aq Ar uid .
Each mount daemon uses a unique socket derived from the mountpoint hash, e.g.\&
.Pa /tmp/afp_server- Ns Aq Ar uid Ns - Ns Aq Ar hash .
This option is primarily used internally by
.Xr afp_client 1 .
.El
.Sh SEE ALSO
.Xr afp_client 1 ,
.Xr afpsld 1,
.Xr mount_afpfs 1
